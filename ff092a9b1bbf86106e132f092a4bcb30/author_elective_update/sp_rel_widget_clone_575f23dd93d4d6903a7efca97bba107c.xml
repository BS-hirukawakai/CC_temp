<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_rel_widget_clone">
    <sp_rel_widget_clone action="DELETE">
        <child display_value="CSP Stock Header ">0f5f2b1d93d4d6903a7efca97bba1077</child>
        <cloned>2024-08-28 01:32:44</cloned>
        <last_validated>2024-08-28 01:32:44</last_validated>
        <parent display_value="CSP 在庫ヘッダー ">c60d8fabc332120071d07bfaa2d3aebb</parent>
        <payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;sp_widget&gt;&lt;category/&gt;&lt;client_script&gt;&lt;![CDATA[function ($rootScope, $scope, snRecordWatcher, spUtil, $location, $uibModal, cabrillo, $timeout,$window) {
	var c=this;
	$scope.userID = $scope.user.sys_id;
	$scope.avatarProfile = {
		userID: $scope.user.sys_id,
		name: $scope.user.name,
		initials: $window.NOW.user_initials
	};
	if ($window.NOW.user_avatar) {
		$scope.avatarProfile.userImage = $window.NOW.user_avatar;
	}
	if (cabrillo.isNative())
		$scope.isViewNative = true;

	function popupCenter(url, title, w, h) {
		// Fixes dual-screen position                         Most browsers      Firefox
		var dualScreenLeft = window.screenLeft != undefined ? window.screenLeft : screen.left;
		var dualScreenTop = window.screenTop != undefined ? window.screenTop : screen.top;

		var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
		var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;

		var left = ((width / 2) - (w / 2)) + dualScreenLeft;
		var top = ((height / 2) - (h / 2)) + dualScreenTop;
		var newWindow = window.open(url, title, 'scrollbars=yes, width=' + w + ', height=' + h + ', top=' + top + ', left=' + left);

		// Puts focus on the newWindow
		if (window.focus) {
			newWindow.focus();
		}
		newWindow.onload = function() {
			var jq = newWindow.$j;
			console.log(jq);
			jq('#back_cell').hide();
			jq('#sc_attachment_button').hide();
		};
		return newWindow;
	}

	$scope.openAnonymousChatPopUp = function(evt) {
		$(evt.target).blur();
		var url = "com.glideapp.servicecatalog_cat_item_view.do?v=1&amp;sysparm_id=2ee88dafdb416200f6c270f5bf9619cf&amp;sysparm_preview=true&amp;sysparm_domain_restore=false&amp;sysparm_stack=no&amp;sysparm_queue_id=3a40c019c333120071d07bfaa2d3ae17&amp;sysparm_live_agent_only="+$scope.data.live_agent_only;
		popupCenter (url, "chat_popup", 450, 580);
	};


	$scope.openPopUp = function(evt) {
		$(evt.target).blur();
				var url;
		var queue_id;
		if ($scope.data.queueType == "connect") {
			queue_id = $scope.data.connect_support_queue_id;
		} else {
			queue_id = $scope.data.interaction_queue_id;
		}
		if ($scope.data.live_agent_only) {
			url = "com.glideapp.servicecatalog_cat_item_view.do?v=1&amp;sysparm_id=2bd27963fc241300964fabc2fdf10ea4&amp;sysparm_preview=true&amp;sysparm_domain_restore=false&amp;sysparm_stack=no&amp;sysparm_queue_id="+queue_id;
		} else {
			url = "CustomerServiceChat.do?portal=csp&amp;queue_id="+queue_id+"&amp;user_id="+$scope.userID+"&amp;live_agent_only="+$scope.data.live_agent_only;
		}
		var popup = window.open (url, "chat_popup", "width=450, height=600");
	};

	$scope.openLogin = function () {
		var portal=c.data.portal_url_suffix ;
		var locationPath=$window.location.pathname;
		var locationSearch=$window.location.search;
		var login_page=c.data.portal_login_page;
			$location.url('/'+portal+'?id='+login_page);
		  $scope.$on('$locationChangeStart', function (event, next, current) {
				var nextIsLogin=false;
				var nextUrl=new URL(next);
				nextUrl=nextUrl.search.split('id=')[1];
				if(nextUrl &amp;&amp; nextUrl==login_page)
				    nextIsLogin=true;
		     if(!c.data.isLoggedIn &amp;&amp; nextIsLogin)
		         $window.sessionStorage.setItem('navBackUri',locationPath+locationSearch);
			});
	/* Redirecting to login page when login link on header is clicked, for the SP login widget to get new look according to STRY50124975
		$scope.modalInstance = $uibModal.open({
			templateUrl: 'csp-modalLogin',
			scope: $scope
		});
		*/
	};

	$rootScope.$on('sp.avatar_changed', function() {
		$scope.userID = "";
		$timeout(function(){
			$scope.userID = $scope.user.sys_id;
		});
	});

	$scope.isHomepage = function() {
		if (!$scope.page.id)
			return true;

		if ($scope.page.id == $scope.portal.homepage_dv)
			return true;

		return false;
	};

}]]&gt;&lt;/client_script&gt;&lt;controller_as&gt;c&lt;/controller_as&gt;&lt;css&gt;.navbar {
  transition: 250ms opacity ease-in-out;
  -webkit-transition: 250ms opacity ease-in-out;
  border: 0;
  border-bottom: 4px solid $sp-navbar-divider-color;
}

.navbar-fade {
  opacity: 0.4;
}

.navbar-inverse .navbar-toggle {
  border-color: rgba(255, 255, 255, 0.25);
}

.nav &amp;gt; li &amp;gt; a {
  max-height: 50px;
}

.navbar-brand {
  height: 50px;
  padding: 0;
}

.navbar-brand img, .navbar-brand span {
  margin-left: $sp-logo-margin-x;
  margin-right: $sp-logo-margin-x;
  margin-top: $sp-logo-margin-y;
  margin-bottom: $sp-logo-margin-y;
  display: block;
  max-height: $sp-logo-max-height;
  max-width: $sp-logo-max-width;
  position: relative;
  top: 50%;
  -webkit-transform: translateY(-50%);
  -ms-transform: translateY(-50%);
  transform: translateY(-50%);
}
.breadcrumb-container {
  background-color: $panel-bg;
}

/* for mobile app */
.navbar-inverse.is-native {
  background-color: #405060;
}

nav{
 margin-bottom: 0px;
 border-radius: 0px;
}

.navbar-nav {
  margin: 0px;
  .visible-xs-block a {
    overflow: hidden;
  }
}

@media screen and (min-width: 768px) {
  .navbar-right {
    display: flex !important;
  }
} &lt;/css&gt;&lt;data_table&gt;sp_instance&lt;/data_table&gt;&lt;demo_data/&gt;&lt;description/&gt;&lt;docs/&gt;&lt;field_list/&gt;&lt;has_preview&gt;false&lt;/has_preview&gt;&lt;id/&gt;&lt;internal&gt;false&lt;/internal&gt;&lt;link&gt;&lt;![CDATA[function(scope, element) {
    scope.$on('$locationChangeStart', function() {
		$('#sp-nav-bar.in').removeClass('in').addClass('collapse').attr("aria-expanded", "false");
		$("[data-target='#sp-nav-bar']").attr("aria-expanded", "false");
	});
	
	var prevFocusIndex = -1;// This is used for prev focus of nav-bar(avatar) drop down items when its visible.
	$(document).keyup(function(event) {
		if (event.which == 9 || event.which == 37 || event.which == 39) { //tab key handler + arrow keys
			if ($(event.target).parents(".dropdown-menu").length == 0) { //if we are NOT inside a dropdown...
				//close the dropdowns
				$(".dropdown").removeClass("open");
				$("[data-toggle='dropdown']").attr("aria-expanded", "false");
				prevFocusIndex = -1;
			}
		} else if(event.which == 38 || event.which == 40) {
			var parent = $(event.target).parents('.dropdown-menu');
			
			// To support custom drop downs like cart and wish list.
			if (parent.hasClass('custom-drop-down')) return;
			
			if (parent.length) {
				var items = $(parent).find('li a, li button');
				if (!items.length)
					return;

				var index = items.index(items.filter(':focus'));
				if(index == -1) return;
				
				if (prevFocusIndex == index) {
					if (index == 0)
						index = items.length - 1;
					else if (index == items.length - 1)
						index = 0;
						
						items[index].focus();
				} else if (event.which == 38 &amp;&amp; index == 0 &amp;&amp; prevFocusIndex == -1) { // to handle newly opened dropdown on keyup
					index = items.length - 1;
					items[index].focus();
				}
				prevFocusIndex = index;
			
			} else {
				// Upon down/up arrow key event from the menu target element,
        // focus the first/last menu item to be consistent with click behavior and conform to standard menubar pattern below
				// https://www.w3.org/TR/wai-aria-practices/examples/menubar/menubar-1/menubar-1.html
				if ($(event.target).is('[data-toggle="dropdown"]')) {
					var parent = $(event.target).parent().find('.dropdown-menu');
					
					// To support custom drop downs like cart and wish list.
					if (parent.hasClass('custom-drop-down')) return;
					
					var items = $(parent).find('li a, li button');
					if (!items.length) return;
					
					var index = -1;
					if(event.which == 40) //down
						index = 0;
					else if(event.which == 38) //up
						index = items.length &gt; 0 ? items.length-1 : 0;
					
					items[index].focus();
					prevFocusIndex = index;
					
				}		
			}
		}
		// on esc/close of the menu, reset the index
		if(event.which == 27)
			prevFocusIndex = -1;
		
		if (event.which == 13 || event.which == 32)
			$(event.target).parent(".dropdown.open").find("ul.dropdown-menu li:first-child a").focus();
	});

	$(element).on('click.nav','.navbar-collapse.in',function(e) {
		var target = $(e.target);
		if (target.is('a')) {
			// collapse mobile nav if clicked an anchor
			$(this).removeClass('in').addClass('collapse');
			return;
		}

		// if neither target nor parent is an anchor, do nothing
		if (!target.parent().is('a'))
			return;

		// collapse mobile nav if target is part of a submenu
		if (target.parents("ul.dropdown-menu").length &gt; 0)
			$(this).removeClass('in').addClass('collapse');
	});
}]]&gt;&lt;/link&gt;&lt;name&gt;CSP Stock Header &lt;/name&gt;&lt;option_schema/&gt;&lt;public&gt;true&lt;/public&gt;&lt;roles/&gt;&lt;script&gt;&lt;![CDATA[// Defines the support queue ID that will be linked to by the Live Chat link in header
data.isLoggedIn=gs.isLoggedIn();
data.portal = $sp.getPortalRecord();
data.portal_url_suffix = data.portal.getValue("url_suffix")+'';
data.portal_login_page= $sp.getDisplayValue('login_page') || 'csm_login';
data.connect_support_queue_id = $sp.getValue('sp_chat_queue');
data.login_page = $sp.getValue('login_page');
data.enable_legacy_chat = gs.getProperty('csp.legacy_chat');
data.logoLinkText = gs.getMessage("{0} homepage", data.portal.getValue("title"));
var menu = $sp.getValue("sp_rectangle_menu");
data.menu = $sp.getWidgetFromInstance(menu);
data.langSelector = pm.isActive('com.glide.i18n')? $sp.getWidget('sp-lang-selector') : "";
if (data.menu &amp;&amp; data.menu.data) {
	data.menu.data.replace = true;
	// Hide login if menu already has link to login
	data.hasLogin = false;
	if (data.menu.data.menu.items) {
		for(var i in data.menu.data.menu.items) {
			var item = data.menu.data.menu.items[i];
			if (item.type == 'page' &amp;&amp; item.sp_page == data.login_page)
				data.hasLogin = true;
		}
	}
}

var profileURL = 'user_profile';
if (gs.isLoggedIn()) {
  var userClassKey = gs.getUser().getID() + "_userClass";
  var userClass = gs.getSession().getClientData(userClassKey);
  if (!userClass) {
    var sysUserGR = new GlideRecord("sys_user");
    if (sysUserGR.get(gs.getUser().getID())) {
      userClass = sysUserGR.getValue("sys_class_name");
      gs.getSession().putClientData(userClassKey, userClass);
    }
  }
  var hasConsumerRole = gs.getUser().hasRole('sn_customerservice.consumer');
  var hasCustomerRole = gs.getUser().hasRole('sn_customerservice.customer');

  if (hasConsumerRole &amp;&amp; userClass == 'csm_consumer_user')
    profileURL = 'csp_profile';
  else if (hasCustomerRole &amp;&amp; userClass == 'customer_contact')
    profileURL = 'csm_profile';
}
data.supportProfilePortal = profileURL;

var qsConfig = $sp.getValue("quick_start_config");
var qsConfigJson = qsConfig ? JSON.parse(qsConfig)[0] : {};
data.interaction_queue_id = qsConfigJson.default_interaction_queue;
data.loginWidget = $sp.getWidgetFromInstance('login-modal-customerservice');
data.typeahead = $sp.getWidgetFromInstance('typeahead-search');

data.isVAActive = false;
data.queueType = "connect";
var liveAgent = new GlideRecord("sys_cs_live_agent_setup");
liveAgent.query();
if (liveAgent.next()) {
	data.queueType = liveAgent.getValue("csm_fulfiller");
}
data.isVAActive = GlidePluginManager.isActive('com.glide.cs.chatbot');

// changes data.live_agent_only to true to allow only live agent
data.live_agent_only = false;
if (!data.live_agent_only) {
	data.live_agent_only = !data.isVAActive;
}

]]&gt;&lt;/script&gt;&lt;servicenow&gt;false&lt;/servicenow&gt;&lt;sys_class_name&gt;sp_header_footer&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2016-04-21 18:27:36&lt;/sys_created_on&gt;&lt;sys_id&gt;c60d8fabc332120071d07bfaa2d3aebb&lt;/sys_id&gt;&lt;sys_mod_count&gt;27&lt;/sys_mod_count&gt;&lt;sys_name&gt;CSP Stock Header &lt;/sys_name&gt;&lt;sys_package display_value="Consumer Service Portal Classic" source="com.glide.service-portal.consumer-portal"&gt;3fdb831bc3f74210e8adb01115013163&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;&lt;sys_update_name&gt;sp_header_footer_c60d8fabc332120071d07bfaa2d3aebb&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2022-10-13 03:16:46&lt;/sys_updated_on&gt;&lt;template&gt;&lt;![CDATA[&lt;div&gt;
  &lt;nav aria-label="main" class="navbar-inverse" ng-class="::{'navbar':!isViewNative, 'is-native': isViewNative}"
       role="navigation"&gt;
    &lt;div ng-show="::!isViewNative" class="navbar-header"&gt;
      &lt;a class="navbar-brand" ng-if="::!portal.logo" href="?id={{::portal.homepage_dv}}"&gt;&lt;span&gt;{{::portal.title}}&lt;/span&gt;&lt;/a&gt;
      &lt;a class="navbar-brand navbar-brand-logo" ng-if="::portal.logo" href="?id={{::portal.homepage_dv}}" aria-label="{{::data.logoLinkText}}"&gt;
        &lt;img alt="{{::data.logoLinkText}}" ng-src="{{::portal.logo}}" /&gt;
      &lt;/a&gt;

      &lt;button type="button" class="navbar-toggle collapsed" data-toggle="collapse" aria-expanded="false" data-target="#sp-nav-bar"&gt;
        &lt;span class="sr-only"&gt;${Toggle navigation}&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
      &lt;/button&gt;
    &lt;/div&gt;

    &lt;div sp-navbar-toggle="" class="collapse navbar-right" id="sp-nav-bar"&gt;
      &lt;!-- Include The Menu --&gt;
      &lt;sp-widget widget="data.menu"&gt;&lt;/sp-widget&gt;
	  &lt;!-- Language Selector Menu --&gt;
      &lt;sp-widget widget="::data.langSelector"&gt;&lt;/sp-widget&gt;
      &lt;ul ng-if="::(!user.logged_in &amp;&amp; page.id != portal.login_page_dv &amp;&amp; !data.hasLogin)" class="nav navbar-nav"&gt;
        &lt;li&gt;&lt;a href ng-click="openLogin()"&gt;${Login}&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
      &lt;ul ng-if="::(!user.logged_in &amp;&amp; page.id != portal.login_page_dv &amp;&amp; data.enable_legacy_chat=='true')" class="nav navbar-nav"&gt;
        &lt;li&gt;&lt;a href ng-click="openAnonymousChatPopUp($event)"&gt;${Chat}&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
      &lt;ul ng-if="::user.logged_in" class="nav navbar-nav"&gt;
        &lt;!-- chat, avatar, and logout --&gt;
        &lt;li ng-if="::(data.connect_support_queue_id &amp;&amp; data.enable_legacy_chat=='true')"&gt;&lt;a href ng-click="openPopUp($event)"&gt;${Chat}&lt;/a&gt;&lt;/li&gt;
        &lt;li class="dropdown hidden-xs"&gt;
          &lt;a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown"&gt;
            &lt;span class="navbar-avatar"&gt;&lt;sn-avatar class="avatar-small-medium" primary="avatarProfile" /&gt;&lt;/span&gt;
            &lt;span class="visible-lg-inline"&gt;{{::user.name}}&lt;/span&gt;
          &lt;/a&gt;
          &lt;ul class="dropdown-menu"&gt;
			      &lt;li&gt;&lt;a ng-href="?id={{::data.supportProfilePortal}}"&gt;${Profile}&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href="{{::portal.logoutUrl}}"&gt;${Logout}&lt;/a&gt;&lt;/li&gt;
          &lt;/ul&gt;
        &lt;/li&gt;
        &lt;li class="visible-xs-block"&gt;&lt;a ng-href="?id={{::data.supportProfilePortal}}"&gt;&lt;span class="navbar-avatar"&gt;&lt;sn-avatar class="avatar-small-medium" primary="avatarProfile" /&gt;&lt;/span&gt;{{::user.name}}&lt;/a&gt;&lt;/li&gt;
        &lt;li class="visible-xs-block"&gt;&lt;a href="{{::portal.logoutUrl}}"&gt;${Logout}&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;/nav&gt;
&lt;/div&gt;]]&gt;&lt;/template&gt;&lt;/sp_widget&gt;</payload>
        <sys_class_name>sp_rel_widget_clone</sys_class_name>
        <sys_created_by>akimoto.miri@blueship.co.jp</sys_created_by>
        <sys_created_on>2024-08-28 01:32:44</sys_created_on>
        <sys_id>575f23dd93d4d6903a7efca97bba107c</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>0f5f2b1d93d4d6903a7efca97bba1077</sys_name>
        <sys_package display_value="CCテンプレート" source="x_bllt_bs_cc">ff092a9b1bbf86106e132f092a4bcb30</sys_package>
        <sys_policy/>
        <sys_scope display_value="CCテンプレート">ff092a9b1bbf86106e132f092a4bcb30</sys_scope>
        <sys_update_name>sp_rel_widget_clone_575f23dd93d4d6903a7efca97bba107c</sys_update_name>
        <sys_updated_by>akimoto.miri@blueship.co.jp</sys_updated_by>
        <sys_updated_on>2024-08-28 01:32:44</sys_updated_on>
    </sp_rel_widget_clone>
    <sys_update_version action="INSERT_OR_UPDATE">
        <action>DELETE</action>
        <application display_value="CCテンプレート">ff092a9b1bbf86106e132f092a4bcb30</application>
        <file_path/>
        <instance_id>a12977c7ebbf065856eafddacad0cda9</instance_id>
        <instance_name>democreatorwf81141</instance_name>
        <name>sp_rel_widget_clone_575f23dd93d4d6903a7efca97bba107c</name>
        <payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_rel_widget_clone"><sp_rel_widget_clone action="INSERT_OR_UPDATE"><child display_value="CSP Stock Header ">0f5f2b1d93d4d6903a7efca97bba1077</child><cloned>2024-08-28 01:32:44</cloned><last_validated>2024-08-28 01:32:44</last_validated><parent display_value="CSP 在庫ヘッダー ">c60d8fabc332120071d07bfaa2d3aebb</parent><payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;sp_widget&gt;&lt;category/&gt;&lt;client_script&gt;&lt;![CDATA[function ($rootScope, $scope, snRecordWatcher, spUtil, $location, $uibModal, cabrillo, $timeout,$window) {
	var c=this;
	$scope.userID = $scope.user.sys_id;
	$scope.avatarProfile = {
		userID: $scope.user.sys_id,
		name: $scope.user.name,
		initials: $window.NOW.user_initials
	};
	if ($window.NOW.user_avatar) {
		$scope.avatarProfile.userImage = $window.NOW.user_avatar;
	}
	if (cabrillo.isNative())
		$scope.isViewNative = true;

	function popupCenter(url, title, w, h) {
		// Fixes dual-screen position                         Most browsers      Firefox
		var dualScreenLeft = window.screenLeft != undefined ? window.screenLeft : screen.left;
		var dualScreenTop = window.screenTop != undefined ? window.screenTop : screen.top;

		var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
		var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;

		var left = ((width / 2) - (w / 2)) + dualScreenLeft;
		var top = ((height / 2) - (h / 2)) + dualScreenTop;
		var newWindow = window.open(url, title, 'scrollbars=yes, width=' + w + ', height=' + h + ', top=' + top + ', left=' + left);

		// Puts focus on the newWindow
		if (window.focus) {
			newWindow.focus();
		}
		newWindow.onload = function() {
			var jq = newWindow.$j;
			console.log(jq);
			jq('#back_cell').hide();
			jq('#sc_attachment_button').hide();
		};
		return newWindow;
	}

	$scope.openAnonymousChatPopUp = function(evt) {
		$(evt.target).blur();
		var url = "com.glideapp.servicecatalog_cat_item_view.do?v=1&amp;sysparm_id=2ee88dafdb416200f6c270f5bf9619cf&amp;sysparm_preview=true&amp;sysparm_domain_restore=false&amp;sysparm_stack=no&amp;sysparm_queue_id=3a40c019c333120071d07bfaa2d3ae17&amp;sysparm_live_agent_only="+$scope.data.live_agent_only;
		popupCenter (url, "chat_popup", 450, 580);
	};


	$scope.openPopUp = function(evt) {
		$(evt.target).blur();
				var url;
		var queue_id;
		if ($scope.data.queueType == "connect") {
			queue_id = $scope.data.connect_support_queue_id;
		} else {
			queue_id = $scope.data.interaction_queue_id;
		}
		if ($scope.data.live_agent_only) {
			url = "com.glideapp.servicecatalog_cat_item_view.do?v=1&amp;sysparm_id=2bd27963fc241300964fabc2fdf10ea4&amp;sysparm_preview=true&amp;sysparm_domain_restore=false&amp;sysparm_stack=no&amp;sysparm_queue_id="+queue_id;
		} else {
			url = "CustomerServiceChat.do?portal=csp&amp;queue_id="+queue_id+"&amp;user_id="+$scope.userID+"&amp;live_agent_only="+$scope.data.live_agent_only;
		}
		var popup = window.open (url, "chat_popup", "width=450, height=600");
	};

	$scope.openLogin = function () {
		var portal=c.data.portal_url_suffix ;
		var locationPath=$window.location.pathname;
		var locationSearch=$window.location.search;
		var login_page=c.data.portal_login_page;
			$location.url('/'+portal+'?id='+login_page);
		  $scope.$on('$locationChangeStart', function (event, next, current) {
				var nextIsLogin=false;
				var nextUrl=new URL(next);
				nextUrl=nextUrl.search.split('id=')[1];
				if(nextUrl &amp;&amp; nextUrl==login_page)
				    nextIsLogin=true;
		     if(!c.data.isLoggedIn &amp;&amp; nextIsLogin)
		         $window.sessionStorage.setItem('navBackUri',locationPath+locationSearch);
			});
	/* Redirecting to login page when login link on header is clicked, for the SP login widget to get new look according to STRY50124975
		$scope.modalInstance = $uibModal.open({
			templateUrl: 'csp-modalLogin',
			scope: $scope
		});
		*/
	};

	$rootScope.$on('sp.avatar_changed', function() {
		$scope.userID = "";
		$timeout(function(){
			$scope.userID = $scope.user.sys_id;
		});
	});

	$scope.isHomepage = function() {
		if (!$scope.page.id)
			return true;

		if ($scope.page.id == $scope.portal.homepage_dv)
			return true;

		return false;
	};

}]]&gt;&lt;/client_script&gt;&lt;controller_as&gt;c&lt;/controller_as&gt;&lt;css&gt;.navbar {
  transition: 250ms opacity ease-in-out;
  -webkit-transition: 250ms opacity ease-in-out;
  border: 0;
  border-bottom: 4px solid $sp-navbar-divider-color;
}

.navbar-fade {
  opacity: 0.4;
}

.navbar-inverse .navbar-toggle {
  border-color: rgba(255, 255, 255, 0.25);
}

.nav &amp;gt; li &amp;gt; a {
  max-height: 50px;
}

.navbar-brand {
  height: 50px;
  padding: 0;
}

.navbar-brand img, .navbar-brand span {
  margin-left: $sp-logo-margin-x;
  margin-right: $sp-logo-margin-x;
  margin-top: $sp-logo-margin-y;
  margin-bottom: $sp-logo-margin-y;
  display: block;
  max-height: $sp-logo-max-height;
  max-width: $sp-logo-max-width;
  position: relative;
  top: 50%;
  -webkit-transform: translateY(-50%);
  -ms-transform: translateY(-50%);
  transform: translateY(-50%);
}
.breadcrumb-container {
  background-color: $panel-bg;
}

/* for mobile app */
.navbar-inverse.is-native {
  background-color: #405060;
}

nav{
 margin-bottom: 0px;
 border-radius: 0px;
}

.navbar-nav {
  margin: 0px;
  .visible-xs-block a {
    overflow: hidden;
  }
}

@media screen and (min-width: 768px) {
  .navbar-right {
    display: flex !important;
  }
} &lt;/css&gt;&lt;data_table&gt;sp_instance&lt;/data_table&gt;&lt;demo_data/&gt;&lt;description/&gt;&lt;docs/&gt;&lt;field_list/&gt;&lt;has_preview&gt;false&lt;/has_preview&gt;&lt;id/&gt;&lt;internal&gt;false&lt;/internal&gt;&lt;link&gt;&lt;![CDATA[function(scope, element) {
    scope.$on('$locationChangeStart', function() {
		$('#sp-nav-bar.in').removeClass('in').addClass('collapse').attr("aria-expanded", "false");
		$("[data-target='#sp-nav-bar']").attr("aria-expanded", "false");
	});
	
	var prevFocusIndex = -1;// This is used for prev focus of nav-bar(avatar) drop down items when its visible.
	$(document).keyup(function(event) {
		if (event.which == 9 || event.which == 37 || event.which == 39) { //tab key handler + arrow keys
			if ($(event.target).parents(".dropdown-menu").length == 0) { //if we are NOT inside a dropdown...
				//close the dropdowns
				$(".dropdown").removeClass("open");
				$("[data-toggle='dropdown']").attr("aria-expanded", "false");
				prevFocusIndex = -1;
			}
		} else if(event.which == 38 || event.which == 40) {
			var parent = $(event.target).parents('.dropdown-menu');
			
			// To support custom drop downs like cart and wish list.
			if (parent.hasClass('custom-drop-down')) return;
			
			if (parent.length) {
				var items = $(parent).find('li a, li button');
				if (!items.length)
					return;

				var index = items.index(items.filter(':focus'));
				if(index == -1) return;
				
				if (prevFocusIndex == index) {
					if (index == 0)
						index = items.length - 1;
					else if (index == items.length - 1)
						index = 0;
						
						items[index].focus();
				} else if (event.which == 38 &amp;&amp; index == 0 &amp;&amp; prevFocusIndex == -1) { // to handle newly opened dropdown on keyup
					index = items.length - 1;
					items[index].focus();
				}
				prevFocusIndex = index;
			
			} else {
				// Upon down/up arrow key event from the menu target element,
        // focus the first/last menu item to be consistent with click behavior and conform to standard menubar pattern below
				// https://www.w3.org/TR/wai-aria-practices/examples/menubar/menubar-1/menubar-1.html
				if ($(event.target).is('[data-toggle="dropdown"]')) {
					var parent = $(event.target).parent().find('.dropdown-menu');
					
					// To support custom drop downs like cart and wish list.
					if (parent.hasClass('custom-drop-down')) return;
					
					var items = $(parent).find('li a, li button');
					if (!items.length) return;
					
					var index = -1;
					if(event.which == 40) //down
						index = 0;
					else if(event.which == 38) //up
						index = items.length &gt; 0 ? items.length-1 : 0;
					
					items[index].focus();
					prevFocusIndex = index;
					
				}		
			}
		}
		// on esc/close of the menu, reset the index
		if(event.which == 27)
			prevFocusIndex = -1;
		
		if (event.which == 13 || event.which == 32)
			$(event.target).parent(".dropdown.open").find("ul.dropdown-menu li:first-child a").focus();
	});

	$(element).on('click.nav','.navbar-collapse.in',function(e) {
		var target = $(e.target);
		if (target.is('a')) {
			// collapse mobile nav if clicked an anchor
			$(this).removeClass('in').addClass('collapse');
			return;
		}

		// if neither target nor parent is an anchor, do nothing
		if (!target.parent().is('a'))
			return;

		// collapse mobile nav if target is part of a submenu
		if (target.parents("ul.dropdown-menu").length &gt; 0)
			$(this).removeClass('in').addClass('collapse');
	});
}]]&gt;&lt;/link&gt;&lt;name&gt;CSP Stock Header &lt;/name&gt;&lt;option_schema/&gt;&lt;public&gt;true&lt;/public&gt;&lt;roles/&gt;&lt;script&gt;&lt;![CDATA[// Defines the support queue ID that will be linked to by the Live Chat link in header
data.isLoggedIn=gs.isLoggedIn();
data.portal = $sp.getPortalRecord();
data.portal_url_suffix = data.portal.getValue("url_suffix")+'';
data.portal_login_page= $sp.getDisplayValue('login_page') || 'csm_login';
data.connect_support_queue_id = $sp.getValue('sp_chat_queue');
data.login_page = $sp.getValue('login_page');
data.enable_legacy_chat = gs.getProperty('csp.legacy_chat');
data.logoLinkText = gs.getMessage("{0} homepage", data.portal.getValue("title"));
var menu = $sp.getValue("sp_rectangle_menu");
data.menu = $sp.getWidgetFromInstance(menu);
data.langSelector = pm.isActive('com.glide.i18n')? $sp.getWidget('sp-lang-selector') : "";
if (data.menu &amp;&amp; data.menu.data) {
	data.menu.data.replace = true;
	// Hide login if menu already has link to login
	data.hasLogin = false;
	if (data.menu.data.menu.items) {
		for(var i in data.menu.data.menu.items) {
			var item = data.menu.data.menu.items[i];
			if (item.type == 'page' &amp;&amp; item.sp_page == data.login_page)
				data.hasLogin = true;
		}
	}
}

var profileURL = 'user_profile';
if (gs.isLoggedIn()) {
  var userClassKey = gs.getUser().getID() + "_userClass";
  var userClass = gs.getSession().getClientData(userClassKey);
  if (!userClass) {
    var sysUserGR = new GlideRecord("sys_user");
    if (sysUserGR.get(gs.getUser().getID())) {
      userClass = sysUserGR.getValue("sys_class_name");
      gs.getSession().putClientData(userClassKey, userClass);
    }
  }
  var hasConsumerRole = gs.getUser().hasRole('sn_customerservice.consumer');
  var hasCustomerRole = gs.getUser().hasRole('sn_customerservice.customer');

  if (hasConsumerRole &amp;&amp; userClass == 'csm_consumer_user')
    profileURL = 'csp_profile';
  else if (hasCustomerRole &amp;&amp; userClass == 'customer_contact')
    profileURL = 'csm_profile';
}
data.supportProfilePortal = profileURL;

var qsConfig = $sp.getValue("quick_start_config");
var qsConfigJson = qsConfig ? JSON.parse(qsConfig)[0] : {};
data.interaction_queue_id = qsConfigJson.default_interaction_queue;
data.loginWidget = $sp.getWidgetFromInstance('login-modal-customerservice');
data.typeahead = $sp.getWidgetFromInstance('typeahead-search');

data.isVAActive = false;
data.queueType = "connect";
var liveAgent = new GlideRecord("sys_cs_live_agent_setup");
liveAgent.query();
if (liveAgent.next()) {
	data.queueType = liveAgent.getValue("csm_fulfiller");
}
data.isVAActive = GlidePluginManager.isActive('com.glide.cs.chatbot');

// changes data.live_agent_only to true to allow only live agent
data.live_agent_only = false;
if (!data.live_agent_only) {
	data.live_agent_only = !data.isVAActive;
}

]]&gt;&lt;/script&gt;&lt;servicenow&gt;false&lt;/servicenow&gt;&lt;sys_class_name&gt;sp_header_footer&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2016-04-21 18:27:36&lt;/sys_created_on&gt;&lt;sys_id&gt;c60d8fabc332120071d07bfaa2d3aebb&lt;/sys_id&gt;&lt;sys_mod_count&gt;27&lt;/sys_mod_count&gt;&lt;sys_name&gt;CSP Stock Header &lt;/sys_name&gt;&lt;sys_package display_value="Consumer Service Portal Classic" source="com.glide.service-portal.consumer-portal"&gt;3fdb831bc3f74210e8adb01115013163&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;&lt;sys_update_name&gt;sp_header_footer_c60d8fabc332120071d07bfaa2d3aebb&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2022-10-13 03:16:46&lt;/sys_updated_on&gt;&lt;template&gt;&lt;![CDATA[&lt;div&gt;
  &lt;nav aria-label="main" class="navbar-inverse" ng-class="::{'navbar':!isViewNative, 'is-native': isViewNative}"
       role="navigation"&gt;
    &lt;div ng-show="::!isViewNative" class="navbar-header"&gt;
      &lt;a class="navbar-brand" ng-if="::!portal.logo" href="?id={{::portal.homepage_dv}}"&gt;&lt;span&gt;{{::portal.title}}&lt;/span&gt;&lt;/a&gt;
      &lt;a class="navbar-brand navbar-brand-logo" ng-if="::portal.logo" href="?id={{::portal.homepage_dv}}" aria-label="{{::data.logoLinkText}}"&gt;
        &lt;img alt="{{::data.logoLinkText}}" ng-src="{{::portal.logo}}" /&gt;
      &lt;/a&gt;

      &lt;button type="button" class="navbar-toggle collapsed" data-toggle="collapse" aria-expanded="false" data-target="#sp-nav-bar"&gt;
        &lt;span class="sr-only"&gt;${Toggle navigation}&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
        &lt;span class="icon-bar"&gt;&lt;/span&gt;
      &lt;/button&gt;
    &lt;/div&gt;

    &lt;div sp-navbar-toggle="" class="collapse navbar-right" id="sp-nav-bar"&gt;
      &lt;!-- Include The Menu --&gt;
      &lt;sp-widget widget="data.menu"&gt;&lt;/sp-widget&gt;
	  &lt;!-- Language Selector Menu --&gt;
      &lt;sp-widget widget="::data.langSelector"&gt;&lt;/sp-widget&gt;
      &lt;ul ng-if="::(!user.logged_in &amp;&amp; page.id != portal.login_page_dv &amp;&amp; !data.hasLogin)" class="nav navbar-nav"&gt;
        &lt;li&gt;&lt;a href ng-click="openLogin()"&gt;${Login}&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
      &lt;ul ng-if="::(!user.logged_in &amp;&amp; page.id != portal.login_page_dv &amp;&amp; data.enable_legacy_chat=='true')" class="nav navbar-nav"&gt;
        &lt;li&gt;&lt;a href ng-click="openAnonymousChatPopUp($event)"&gt;${Chat}&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
      &lt;ul ng-if="::user.logged_in" class="nav navbar-nav"&gt;
        &lt;!-- chat, avatar, and logout --&gt;
        &lt;li ng-if="::(data.connect_support_queue_id &amp;&amp; data.enable_legacy_chat=='true')"&gt;&lt;a href ng-click="openPopUp($event)"&gt;${Chat}&lt;/a&gt;&lt;/li&gt;
        &lt;li class="dropdown hidden-xs"&gt;
          &lt;a href="javascript:void(0)" class="dropdown-toggle" data-toggle="dropdown"&gt;
            &lt;span class="navbar-avatar"&gt;&lt;sn-avatar class="avatar-small-medium" primary="avatarProfile" /&gt;&lt;/span&gt;
            &lt;span class="visible-lg-inline"&gt;{{::user.name}}&lt;/span&gt;
          &lt;/a&gt;
          &lt;ul class="dropdown-menu"&gt;
			      &lt;li&gt;&lt;a ng-href="?id={{::data.supportProfilePortal}}"&gt;${Profile}&lt;/a&gt;&lt;/li&gt;
            &lt;li&gt;&lt;a href="{{::portal.logoutUrl}}"&gt;${Logout}&lt;/a&gt;&lt;/li&gt;
          &lt;/ul&gt;
        &lt;/li&gt;
        &lt;li class="visible-xs-block"&gt;&lt;a ng-href="?id={{::data.supportProfilePortal}}"&gt;&lt;span class="navbar-avatar"&gt;&lt;sn-avatar class="avatar-small-medium" primary="avatarProfile" /&gt;&lt;/span&gt;{{::user.name}}&lt;/a&gt;&lt;/li&gt;
        &lt;li class="visible-xs-block"&gt;&lt;a href="{{::portal.logoutUrl}}"&gt;${Logout}&lt;/a&gt;&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/div&gt;
  &lt;/nav&gt;
&lt;/div&gt;]]&gt;&lt;/template&gt;&lt;/sp_widget&gt;</payload><sys_class_name>sp_rel_widget_clone</sys_class_name><sys_created_by>akimoto.miri@blueship.co.jp</sys_created_by><sys_created_on>2024-08-28 01:32:44</sys_created_on><sys_id>575f23dd93d4d6903a7efca97bba107c</sys_id><sys_mod_count>0</sys_mod_count><sys_name>0f5f2b1d93d4d6903a7efca97bba1077</sys_name><sys_package display_value="CCテンプレート" source="x_bllt_bs_cc">ff092a9b1bbf86106e132f092a4bcb30</sys_package><sys_policy/><sys_scope display_value="CCテンプレート">ff092a9b1bbf86106e132f092a4bcb30</sys_scope><sys_update_name>sp_rel_widget_clone_575f23dd93d4d6903a7efca97bba107c</sys_update_name><sys_updated_by>akimoto.miri@blueship.co.jp</sys_updated_by><sys_updated_on>2024-08-28 01:32:44</sys_updated_on></sp_rel_widget_clone></record_update>]]></payload>
        <payload_hash>900626245</payload_hash>
        <record_name>0f5f2b1d93d4d6903a7efca97bba1077</record_name>
        <reverted_from/>
        <source>3e9dab5993d4d6903a7efca97bba10d0</source>
        <source_table>sys_update_set</source_table>
        <state>previous</state>
        <sys_created_by>akimoto.miri@blueship.co.jp</sys_created_by>
        <sys_created_on>2024-08-28 01:32:44</sys_created_on>
        <sys_id>d75f23dd93d4d6903a7efca97bba107f</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_recorded_at>191969d1b150000001</sys_recorded_at>
        <sys_updated_by>akimoto.miri@blueship.co.jp</sys_updated_by>
        <sys_updated_on>2024-08-28 01:32:44</sys_updated_on>
        <type>Widget Clone</type>
        <update_guid>5b5f23dd30d4d690d425c6111b01567e</update_guid>
        <update_guid_history>5b5f23dd30d4d690d425c6111b01567e:900626245</update_guid_history>
    </sys_update_version>
    <sys_metadata_delete action="INSERT_OR_UPDATE">
        <sys_audit_delete display_value="">5794775d9318d6903a7efca97bba1072</sys_audit_delete>
        <sys_class_name>sys_metadata_delete</sys_class_name>
        <sys_created_by>akimoto.miri@blueship.co.jp</sys_created_by>
        <sys_created_on>2024-08-28 01:55:40</sys_created_on>
        <sys_db_object display_value="" name="sp_rel_widget_clone">sp_rel_widget_clone</sys_db_object>
        <sys_id>c244f6664e214fc1a66d86bb8cb57de9</sys_id>
        <sys_metadata>575f23dd93d4d6903a7efca97bba107c</sys_metadata>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>0f5f2b1d93d4d6903a7efca97bba1077</sys_name>
        <sys_package display_value="CCテンプレート" source="x_bllt_bs_cc">ff092a9b1bbf86106e132f092a4bcb30</sys_package>
        <sys_parent/>
        <sys_policy/>
        <sys_scope display_value="CCテンプレート">ff092a9b1bbf86106e132f092a4bcb30</sys_scope>
        <sys_scope_delete display_value="">b2ab4ec1074e4841827ce296952ecb21</sys_scope_delete>
        <sys_update_name>sp_rel_widget_clone_575f23dd93d4d6903a7efca97bba107c</sys_update_name>
        <sys_update_version display_value="sp_rel_widget_clone_575f23dd93d4d6903a7efca97bba107c">d75f23dd93d4d6903a7efca97bba107f</sys_update_version>
        <sys_updated_by>akimoto.miri@blueship.co.jp</sys_updated_by>
        <sys_updated_on>2024-08-28 01:55:40</sys_updated_on>
    </sys_metadata_delete>
</record_update>
